<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"/><meta name="theme-color" content="#222"/><meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"/><meta name="renderer" content="webkit"/><link rel="icon" type="image/ico" sizes="32x32" href="/assets/favicon.ico"/><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"/><link rel="alternate" href="/rss.xml" title="刀刀博客" type="application/rss+xml"><link rel="alternate" href="/atom.xml" title="刀刀博客" type="application/atom+xml"><link rel="alternate" type="application/json" title="刀刀博客" href="https://chnhqz.github.io/feed.json"/><link rel="preconnect" href="https://lf9-cdn-tos.bytecdntp.com"/><link rel="preconnect" href="https://at.alicdn.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CFredericka%20the%20Great:400,400italic,700,700italic%7CNoto%20Serif%20JP:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic%7CInconsolata:400,400italic,700,700italic&display=swap&subset=latin,latin-ext" media="none" onload="this.media&#x3D;&#39;all&#39;"><link rel="stylesheet" href="/css/app.css?v=0.4.2"><link rel="modulepreload" href="/js/chunk-5NUNSAMU.js"></link><link rel="modulepreload" href="/js/chunk-JK7UX3QB.js"></link><link rel="modulepreload" href="/js/chunk-QAWHJ5B3.js"></link><link rel="modulepreload" href="/js/index.esm-6L4CBMFU.js"></link><link rel="modulepreload" href="/js/post-QRVNG3P5.js"></link><link rel="modulepreload" href="/js/quicklink-4NS4EDEP.js"></link><link rel="modulepreload" href="/js/siteInit.js"></link><link rel="preload" href="https://tva3.sinaimg.cn/large/6833939bly1gicis3attqj20zk0m8k7l.jpg" as="image" fetchpriority="high"><link rel="preload" href="https://tva3.sinaimg.cn/large/6833939bly1gicit4jrvuj20zk0m8785.jpg" as="image" fetchpriority="high"><link rel="preload" href="https://tva3.sinaimg.cn/large/6833939bly1gicitcxhpij20zk0m8hdt.jpg" as="image" fetchpriority="high"><link rel="preload" href="https://tva3.sinaimg.cn/large/6833939bly1gicis081o9j20zk0m8dmr.jpg" as="image" fetchpriority="high"><link rel="preload" href="https://tva3.sinaimg.cn/large/6833939bly1gicit31ffoj20zk0m8naf.jpg" as="image" fetchpriority="high"><link rel="preload" href="https://tva3.sinaimg.cn/large/6833939bly1giciryrr3rj20zk0m8nhk.jpg" as="image" fetchpriority="high"><meta name="description" content="欢迎来到刀刀的笔记空间(^_^)"/><link rel="canonical" href="https://chnhqz.github.io/2024/05/23/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"><title>计算机网络</title><meta name="generator" content="Hexo 7.0.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">计算机网络</h1><div class="meta"><span class="item" title="创建时间：2024-05-23 22:03:39"><span class="icon"><i class="ic i-calendar"></i></span><span class="text">发表于</span><time itemprop="dateCreated datePublished" datetime="2024-05-23T22:03:39+08:00">2024-05-23</time></span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i></span><span class="text">本文字数</span><span>7.7k</span><span class="text">字</span></span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i></span><span class="text">阅读时长</span><span>7 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span><span class="line"></span><span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">testName</a></li></ul><ul class="right" id="rightNav"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div class="pjax" id="imgs"><ul><li class="item" style="background-image: url(&quot;https://tva3.sinaimg.cn/large/6833939bly1gicis3attqj20zk0m8k7l.jpg&quot;);"></li><li class="item" style="background-image: url(&quot;https://tva3.sinaimg.cn/large/6833939bly1gicit4jrvuj20zk0m8785.jpg&quot;);"></li><li class="item" style="background-image: url(&quot;https://tva3.sinaimg.cn/large/6833939bly1gicitcxhpij20zk0m8hdt.jpg&quot;);"></li><li class="item" style="background-image: url(&quot;https://tva3.sinaimg.cn/large/6833939bly1gicis081o9j20zk0m8dmr.jpg&quot;);"></li><li class="item" style="background-image: url(&quot;https://tva3.sinaimg.cn/large/6833939bly1gicit31ffoj20zk0m8naf.jpg&quot;);"></li><li class="item" style="background-image: url(&quot;https://tva3.sinaimg.cn/large/6833939bly1giciryrr3rj20zk0m8nhk.jpg&quot;);"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"></use><use xlink:href="#gentle-wave" x="48" y="3"></use><use xlink:href="#gentle-wave" x="48" y="5"></use><use xlink:href="#gentle-wave" x="48" y="7"></use></g></svg></div><main><div class="inner"><div class="pjax" id="main"><div class="article wrap"><div class="breadcrumb" itemListElement itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i><span><a href="/">首页</a></span></div><article class="post block" itemscope="itemscope" itemtype="http://schema.org/Article" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://chnhqz.github.io/2024/05/23/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"/><span hidden="hidden" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="image" content="/assets/avatar.jpg"/><meta itemprop="name" content="hqz"/><meta itemprop="description" content="=与其感慨路难行，不如马上出发=, 欢迎来到刀刀的笔记空间(^_^)"/></span><span hidden="hidden" itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="刀刀博客"/></span><div class="body md" itemprop="articleBody"><h2 id="概述"><a class="markdownIt-Anchor" href="#概述">#</a> 概述</h2>
<h2 id="osi的七层网络模型"><a class="markdownIt-Anchor" href="#osi的七层网络模型">#</a> OSI 的七层网络模型</h2>
<p>分别为应用层、表示层、会话层、运输层、网络层、链路层和物理层。</p>
<ul>
<li>
<p>应用层（数据）：确定进程之间通信的性质、满足用户需要、提供网络和用户应用。为应用程序提供服务，DNS、HTTP、HTTPS、DHCP、FTP、POP3（Post Office Protocol）、SMTP（Simple Mail Transfer Protocol）都是这层的协议。</p>
<ol>
<li>
<p><strong>DNS (Domain Name System)</strong></p>
<ul>
<li><strong>概念</strong>：DNS 是互联网的 “电话簿”，它将用户友好的域名（<a target="_blank" rel="noopener" href="http://xn--www-eo8e.example.com">如 www.example.com</a>）转换为计算机可以理解的 IP 地址（如 192.0.2.1）。</li>
<li><strong>技术细节</strong>：当用户在浏览器中输入一个域名时，DNS 服务器会查找并返回该域名对应的 IP 地址。这通常涉及多个 DNS 服务器的查询，包括根服务器、顶级域名服务器（<a target="_blank" rel="noopener" href="http://xn--bvs.com">如.com</a>、.org）和权威域名服务器。</li>
</ul>
</li>
<li>
<p><strong>HTTP (HyperText Transfer Protocol)</strong></p>
<ul>
<li><strong>概念</strong>：HTTP 是一种用于传输网页数据的协议，它定义了客户端（如浏览器）和服务器之间的通信规则。</li>
<li><strong>技术细节</strong>：HTTP 是无状态的协议，意味着每个请求都是独立的。一个典型的 HTTP 请求包括请求行、请求头和请求体。服务器接收到请求后，返回一个包含状态行、响应头和响应体的响应。</li>
</ul>
</li>
<li>
<p><strong>HTTPS (HyperText Transfer Protocol Secure)</strong></p>
<ul>
<li><strong>概念</strong>：HTTPS 是 HTTP 的安全版本，通过加密通信确保数据传输的机密性和完整性。</li>
<li><strong>技术细节</strong>：HTTPS 使用 SSL/TLS 协议对 HTTP 通信进行加密，防止数据在传输过程中被窃取或篡改。客户端和服务器之间首先建立一个安全连接（握手过程），然后在该连接上进行 HTTP 通信。</li>
</ul>
</li>
<li>
<p><strong>DHCP (Dynamic Host Configuration Protocol)</strong></p>
<ul>
<li><strong>概念</strong>：DHCP 是一种自动分配 IP 地址和其他网络参数的协议，简化了网络设备的配置过程。</li>
<li><strong>技术细节</strong>：当设备连接到网络时，它会发送一个 DHCP 发现消息，DHCP 服务器响应并分配一个可用的 IP 地址，同时提供其他配置参数如子网掩码、默认网关和 DNS 服务器地址。</li>
</ul>
</li>
<li>
<p><strong>FTP (File Transfer Protocol)</strong></p>
<ul>
<li><strong>概念</strong>：FTP 是一种用于在客户端和服务器之间传输文件的协议，支持文件上传和下载。</li>
<li><strong>技术细节</strong>：FTP 工作在应用层，通过控制连接和数据连接进行文件传输。用户可以通过 FTP 客户端连接到 FTP 服务器，浏览目录并传输文件。FTP 有两种主要模式：主动模式和被动模式，分别影响数据连接的建立方式。</li>
</ul>
</li>
<li>
<p><strong>POP3 (Post Office Protocol version 3)</strong></p>
<ul>
<li><strong>概念</strong>：POP3 是一种从邮件服务器下载电子邮件到本地客户端的协议，适用于离线邮件访问。</li>
<li><strong>技术细节</strong>：POP3 客户端连接到 POP3 服务器，验证用户身份后，下载邮件到本地并默认从服务器上删除这些邮件。POP3 的简单性和离线访问特点使其适合个人邮件管理。</li>
</ul>
</li>
<li>
<p><strong>SMTP (Simple Mail Transfer Protocol)</strong></p>
<ul>
<li><strong>概念</strong>：SMTP 是一种用于发送和转发电子邮件的协议，确保邮件从发件人传递到收件人。</li>
<li><strong>技术细节</strong>：SMTP 客户端将邮件发送到 SMTP 服务器，服务器根据收件人的地址将邮件传递给目标服务器或中继服务器。SMTP 定义了邮件交换的标准格式和传输过程，包括发件人地址、收件人地址、主题和邮件内容。</li>
</ul>
</li>
</ol>
</li>
<li>
<p>表示层（数据）：主要解决用户信息的语法表示问题，表示层提供各种用于应用层数据的编码和转换功能，确保一个系统的应用层发送的数据能被另一个系统的应用层识别，如数据转换，压缩、加密、解密。</p>
</li>
<li>
<p>会话层（数据）：会话层就是负责建立、管理和终止表示层实体之间的通信会话。该层的通信由不同设备中的应用层之间的服务请求和响应组成，比如服务器验证用户登录就是在会话层。</p>
</li>
<li>
<p>传输层（数据段）：实现网络不同主机上的用户进程之间的数据通信，可靠与不可靠的传输、传输层的错误检测、流量控制、拥塞控制。TCP/UDP 就在这层。向用户提供可靠的端到端服务，处理数据包错误、数据包次序，以及其它一些关键传输问题。传输层向高层屏蔽了下层数据通信的细节。</p>
</li>
<li>
<p>网络层（数据包）：本层通过 <code>IP寻址</code>  来建立两个节点之间的连接，为源端的运输层送来的分组，通过路由选择算法为分组通过通信子网选择最适当的路径，选择合适的路由和交换节点，正确无误地按照地址传送给目的端的运输层。 <code>IP</code>  在这层。</p>
</li>
<li>
<p>数据链路层（数据帧）：将上层数据封装成帧，用 <code>MAC</code>  地址访问媒介，并有错误检测和修正。在物理层提供的服务基础上，在通信的实体间建立数据链路连接，传输的数据单位是 “帧”，并采用差错控制与流量控制方法，使有差错的物理线路变成无差错的数据链路。</p>
</li>
<li>
<p>物理层（比特流）：是参考模型的最低层。该层是网络通信的数据传输介质，由连接不同结点的电缆与设备共同构成。主要跟功能是：利用传输介质为数据链路层提供物理连接，负责处理数据传输并监控数据出错率，以便数据流的透明传输。传输数据的单位是比特（Bits）</p>
</li>
</ul>
<p>举个例子🌰：</p>
<blockquote>
<p>小绿人通过电脑端向小鱼人发送 “刀吗”。首先是在 <code>应用层</code> 通过系统程序界面（微信窗口）将 “刀吗” 输入到电脑微信软件。之后电脑在 <code>表示层</code> 将这句话转换为二进制，也可以进行安全加密、压缩等操作。然后小绿人找到小鱼人点击发送，这时候计算机需要找到小鱼人的计算机并和对方建立会话关系，这便是在 <code>会话层</code> 需要完成的动作。下一步是通过 <code>传输层</code> 实现同一个软件的两个端口进行数据传输。再接着是在 <code>网络层</code> 通过小鱼人的 IP 地址，选择最佳路径进行准确的数据传输。再下一步是将数据传输到 <code>数据链路层</code> 听过数据链路层的网卡，继续进行数据传输。最后数据到达 <code>物理层</code> 变成数字信号传输。</p>
</blockquote>
<p><img loading="lazy" data-src="/Users/huangqiuzhao/blog/source/_posts/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/7541336-906a34d0af992f70.png" alt="7541336-906a34d0af992f70.png"></p>
<h2 id="tcpudp"><a class="markdownIt-Anchor" href="#tcpudp">#</a> TCP/UDP</h2>
<h3 id="tcp报文结构"><a class="markdownIt-Anchor" href="#tcp报文结构">#</a> TCP 报文结构</h3>
<p>TCP 协议，<strong>传输控制协议</strong> 一种面向连接的、可靠的、基于字节流通信协议。TCP 把连接作为最基本的抽象单元，每条 TCP 连接有两个端点，TCP 连接的端点即套接字。套接字  <code>socket=(IP地址:端口号)</code>  TCP 连接 = <code>&#123;socket1,socket2&#125;=&#123;(IP1:port1),(IP2:port2)&#125;</code>  TCP 提供全双工通信。</p>
<p><img loading="lazy" data-src="/Users/huangqiuzhao/blog/source/_posts/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20240524142449988.png" alt="image-20240524142449988"></p>
<ul>
<li><strong>源端口</strong>：16 位，标识报文的返回地址。</li>
<li><strong>目的端口</strong>：16 位，指明接收方计算机上的应用程序接口。</li>
<li><strong>序列号</strong>：32 位，在建立连接时由计算机生成的随机数作为其初始值，通过 SYN 包传给接收端主机，每发送一次数据，就<strong>累加</strong>一次该<strong>数据字节数</strong>的大小。用来解决网络包乱序问题。</li>
<li><strong>确认号</strong>：32 位，指下一次<strong>期望</strong>收到的数据的序列号，发送端收到这个确认应答以后可以认为在这个序号以前的数据都已经被正常接收。用来解决丢包的问题。</li>
<li><strong>数据偏移／首部长度</strong>：4 位，TCP 首部可能含有可选项内容，所以 TCP 报头的长度是不确定的，报头不包含任何任选字段则长度为 20 字节，4 位首部长度字段所能表示最大长度为 60 字节。首部长度也叫数据偏移，因为首部长度实际上指示了数据区在报文段中的起始偏移值。</li>
<li><strong>保留</strong>：6 位，为将来定义新的用途保留，现在一般置 0。</li>
<li><strong>校验和</strong>：16 位，由发送端填充，接收端对 TCP 报文段执行 CRC 算法以检验 TCP 报文段在传输过程中是否损坏，这个校验不仅包括 TCP 头部，也包括数据部分。<strong>这是 TCP 实现可靠传输的一个重要保障</strong>。</li>
<li><strong>窗口</strong>：16 位，是 TCP 流量控制的一个手段。通过窗口告诉对方本端的 TCP 接收缓冲区还能容纳多少字节的数据，这样对方可以控制发送数据的速度，从而达到流量控制。窗口大小为 16bit 字段，因而窗口大小最大为 65535。</li>
<li><strong>紧急指针</strong>：16 位，只有当 URG 标志置 1 时紧急指针才有效。紧急指针是一个正的偏移量，和顺序号字段中的值相加表示紧急数据最后一个字节的序号。使用紧急指针是发送端向另一端发送紧急数据的一种方式。</li>
<li><strong>选项和填充</strong>：TCP 头部的最后一个选项字段是可变长的可选信息。这部分最多包含 40 字节，因为 TCP 头部最长是 60 字节。 最常见的可选字段是最长报文大小 MSS，每个连接方通常都在通信的第一个报文段中指明这个选项，它表示本端所能接受的最大报文段的长度。</li>
<li><strong>数据部分</strong>：TCP 报文段中的数据部分是可选的。在连接建立或者终止时，双方交换的报文段仅有 TCP 首部；如果一方没有数据要发送，也会使用没有任何数据的首部来确认收到的数据；在处理超时的许多情况中，也会发送不带任何数据的报文段。</li>
</ul>
<p>还包括控制位：</p>
<ul>
<li><strong>URG</strong>：紧急指针标志，为 1 时表示紧急指针有效，<strong>该报文应该优先传送</strong>，为 0 则忽略紧急指针。</li>
<li><strong>ACK</strong>：确认序号标志，为 1 时表示确认号有效，为 0 表示报文中不含确认信息。携带 ACK 标识的 TCP 报文段被称为<strong>确认报文段</strong>。</li>
<li><strong>RST</strong>：重置连接标志，<strong>用于重置由于主机崩溃或其他原因而出现错误的连接，或者用于拒绝非法的报文段和拒绝连接请求</strong>。称携带 RST 标志的 TCP 报文段为复位报文段。</li>
<li><strong>SYN</strong>：表示请求建立一个连接。称携带 SYN 标志的 TCP 报文段为同步报文段。</li>
<li><strong>FIN</strong>：finish 标志，用于释放连接，为 1 时表示发送方已经没有数据发送了，即关闭本方数据流。称携带 FIN 标志的 TCP 报文段为结束报文段。</li>
<li><strong>PSH</strong>：push 标志，为 1 表示是带有 push 标志的数据，指示接收方在接收到该报文段以后，应优先将这个报文段交给应用程序，而不是在缓冲区排队。</li>
</ul>
<h3 id="tcp保证可靠传输"><a class="markdownIt-Anchor" href="#tcp保证可靠传输">#</a> TCP 保证可靠传输</h3>
<h4 id="校验和"><a class="markdownIt-Anchor" href="#校验和">#</a> 校验和</h4>
<p>TCP 是端到端的传输，由发送方计算校验和，接收方进行验证，目的是为了验证 TCP 首部和数据在发送过程中没有任何改动，一旦发现校验和有差错，直接丢弃 TCP 段并重新发送。</p>
<h4 id="序列号确认应答"><a class="markdownIt-Anchor" href="#序列号确认应答">#</a> 序列号 / 确认应答</h4>
<p>TCP 传输时发送方对每一个发送的消息都会编号，也就是序列号 seq。接收方在每次接收到消息后回复确认应答号 ACK，不仅告诉接收到哪些数据，还包括下一次消息从哪里发送。只要发送方没有接收到确认应答号 ACK，都会重新发送数据。</p>
<h4 id="超时重传"><a class="markdownIt-Anchor" href="#超时重传">#</a> 超时重传</h4>
<p>发送方发送完数据后会等待一定的时间，如果在这个时间内没有接收到 ACK，就会重传数据。如果是发送方发生了丢包，那么接收方在接收到数据后会回复 ACK，如果是接收方回复的 ACK 丢失了导致的重传，那么根据校验和和序列号知道该数据已经接收，丢弃该数据并发送 ACK。</p>
<h4 id="连接管理"><a class="markdownIt-Anchor" href="#连接管理">#</a> 连接管理</h4>
<p>三次握手和四次挥手得以实现。</p>
<h4 id="流量控制滑动窗口控制"><a class="markdownIt-Anchor" href="#流量控制滑动窗口控制">#</a> 流量控制（滑动窗口控制）</h4>
<p>发送方发送数据的快慢取决于接收方接收能力。TCP 的报文信息中有一个 16 位字段来标识滑动窗口，窗口大小就是接收方剩余缓冲区大小，在回复 ACK 时，接收方将自己剩余缓冲区大小填入。发送方根据窗口大小来调整自己的发送速度，如果缓冲区大小为 0，那么发送方会停止发送数据。并且发送方定期会发送探测报文，来获取缓冲区大小。</p>
<h4 id="快速重传"><a class="markdownIt-Anchor" href="#快速重传">#</a> 快速重传</h4>
<p>当接收端收到比期望号大的 seq 时候，就会发送冗余 ACK，在超时重传之前如果收到三个相同的冗余 ACK，那么就知道哪段报文发生了丢包，重传该段报文即可，避免了超时重传。</p>
<h4 id="拥塞控制"><a class="markdownIt-Anchor" href="#拥塞控制">#</a> 拥塞控制</h4>
<p>网络可能刚开始很拥塞，如果在网络传输过程中开始就发送大量数据的话，会发生丢包和超时重传，所以需要慢启动算法、拥塞避免算法、快速重传和快速恢复。</p>
<p>慢启动算法</p>
<p>一开始不发送大量数据，而是应该先发一小部分探测数据，然后由小到大逐渐增大发送窗口。通常在刚刚开始发送报文段时，先把拥塞窗口 cwnd 设置为 1，每次接收到报文之后将窗口大小翻倍。如果指数增长到避免拥塞算法的门限 ssthresh，则改用避免拥塞算法。</p>
<ul>
<li>初始化设置 cwnd = 1，并开始传输数据</li>
<li>收到回馈的 ACK，会将 cwnd 加 1</li>
<li>当发送端一个 RTT 后且未发现有丢包重传，就会将 cwnd = cwnd * 2</li>
<li>当 cwnd &gt;= ssthresh 或发生丢包重传时慢启动结束，进入拥塞避免状态</li>
</ul>
<h4 id="避免拥塞算法"><a class="markdownIt-Anchor" href="#避免拥塞算法">#</a> 避免拥塞算法</h4>
<p>每当收到一个 ACK 时，cwnd 增加 1/cwnd，变为线性增长。一但发现丢包和超时重传，就进入拥塞处理状态。</p>
<h5 id="拥塞发生"><a class="markdownIt-Anchor" href="#拥塞发生">#</a> 拥塞发生</h5>
<p>当网络出现拥塞，也就是会发生数据包重传，重传机制主要有两种：超时重传和快速重传。</p>
<p>ssthresh 和 cwnd 的值会发生变化</p>
<ul>
<li>ssthresh 设为 cwnd/2</li>
<li>cwnd 重置为 1</li>
</ul>
<p>发送三次前一个包的 ACK，于是发送端就会快速地重传，不必等待超时再重传。TCP 认为这种情况不严重，因为大部分没丢，只丢了一小部分，则 ssthresh 和 cwnd 变化如下：</p>
<ul>
<li>cwnd = cwnd/2 ，也就是设置为原来的一半</li>
<li>ssthresh = cwnd</li>
<li>进入快速恢复算法</li>
</ul>
<h5 id="快速恢复"><a class="markdownIt-Anchor" href="#快速恢复">#</a> 快速恢复</h5>
<ul>
<li>拥塞窗口 cwnd = ssthresh + 3 （ 3 的意思是确认有 3 个数据包被收到了）</li>
<li>重传丢失的数据包</li>
<li>如果再收到重复的 ACK，那么 cwnd 增加 1</li>
<li>如果收到新数据的 ACK 后，把 cwnd 设置为第一步中的 ssthresh 的值，原因是该 ACK 确认了新的数据，说明从 duplicated ACK 时的数据都已收到，该恢复过程已经结束，可以回到恢复之前的状态了，也即再次进入拥塞避免状态</li>
</ul>
<h3 id="tcp三次握手"><a class="markdownIt-Anchor" href="#tcp三次握手">#</a> TCP 三次握手</h3>
<p><img loading="lazy" data-src="/Users/huangqiuzhao/blog/source/_posts/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/image-20240524221226071.png" alt="image-20240524221226071"></p>
<p><strong>第一次握手</strong> 客户端请求建立连接，将首部  <code>SYN</code>  标识位置为 <code>1</code> ，初始化序列号 <code>seq=x</code>  ，发送给服务器。并进入 <code>SYN_SENT</code>  状态，等待服务器确认。</p>
<p><strong>第二次握手</strong> 服务器收到  <code>SYN</code>  后，将首部的  <code>SYN</code>  和 <code>ACK</code>  标识位置为 <code>1</code> ，回复确认 <code>ack</code>  的值为客户端发送的序列号 <code>x+1</code> ，同时自己也要初始化一个 <code>seq=y</code> ， <code>ACK</code>  和 <code>SYN</code>  一起发送客户端，进入 <code>SYN_RECV</code>  状态。</p>
<p><strong>第三次握手</strong> 客户端收到服务器的 <code>SYN</code>  和 <code>ACK</code>  包后，向服务器发送确认包  <code>ack</code> ，值为服务器的序列号 <code>y+1</code> ，并且自己的 <code>seq</code>  为 <code>x+1</code> ，此包发送完毕，客户端和服务器进入 <code>ESTABLISHED</code> （TCP 连接成功）状态。</p>
<blockquote>
<p>1.TCP 为什么要三次握手？</p>
</blockquote>
<p>只有三次握手才能证明服务端和客户端的收发能力都是正常的。</p>
<p><strong>第一次握手</strong>：客户端发数据服务端接收，服务端可以知道客户端发消息的能力是正常的，自己接收消息的能力是正常的。</p>
<p><strong>第二次握手</strong>：服务端发消息客户端收，客户端可以知道自己发送接收消息的能力和服务端发送接收消息的能力是正常的。</p>
<p><strong>第三次握手</strong>：客户端再发送消息服务端接收，服务端可以知道自己发送消息的能力是正常的，客户端接收消息的能力是正常的。</p>
<p>由此经过三次握手之后双方就可以都知道自己的发送和接收消息的能力是正常的。</p>
<blockquote>
<p>2.TCP 的三次握手中间出现丢失？⚠️注意，在 TCP 通信连接过程中，ACK 报文发生丢包是不会重传的，ACK 丢失是由对方重传对应的报文。</p>
</blockquote>
<p><strong>第一次丢失</strong>：客户端发送的 SYN 报文会收不到服务端的响应，从而会触发超时重传，重传的 SYN 报文序列号和之前相同，重传最大重传次数由内核参数控制，一般是 5。如果超过最大次数客户端仍没有收到回复就会断开连接。</p>
<p><strong>第二次丢失</strong>：服务端在收到客户端的报文之后会回复 SYN+ACK 报文，如果第二次握手丢失了客户端会认为自己丢包了，触发超时重传，重新发送 SYN 报文，服务端因为收不到确认的 ACK 自身也会重传。</p>
<p><strong>第三次丢失</strong>：客户端收到服务端的 SYN-ACK 报文后会给服务端回一个 ACK 报文，此时客户端状态进入到 <strong>ESTABLISH</strong> 状态。如果发生了丢包，服务端收不到 ACK 会触发超时重传机制，重传 SYN-ACK 报文，直到收到确认 ACK 或者达到最大重传次数。</p>
<blockquote>
<p>3.TCP 为什么不是两次握手？</p>
</blockquote>
<p><strong>避免历史连接</strong> 首要原因是为了防止旧的重复连接初始化造成混乱。如果使用的是两次握手建立连接，可能客户端发送的第一个请求连接并且没有丢失，只是因为在网络中滞留的时间太长了，由于 TCP 的客户端迟迟没有收到确认报文，以为服务器没有收到，此时重新向服务器发送这条报文，此后客户端和服务器经过两次握手完成连接，传输数据，然后关闭连接。之前滞留的那一次请求连接，因为网络通畅了，到达了服务器，这个报文本该是失效的，但是，两次握手的机制将会让客户端和服务器再次建立连接，这将导致不必要的错误和资源的浪费。如果采用的是三次握手，就算是那一次失效的报文传送过来了，服务端接受到了那条失效报文并且回复了确认报文，但是客户端不会再次发出确认。由于服务器收不到确认，就知道客户端并没有请求连接。</p>
<p><strong>同步双方初始序列号</strong> 为了实现可靠数据传输，TCP 协议的通信双方，都必须维护一个序列号，以标识发送出去的数据包中，哪些是已经被对方收到的。 三次握手的过程即是通信双方相互告知序列号起始值，并确认对方已经收到了序列号起始值的必经步骤。如果只是两次握手，至多只有连接发起方的起始序列号能被确认，另一方选择的序列号则得不到确认。</p>
</div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i></span><span class="text">更新于</span><time title="修改时间：2024-05-24 22:27:40" itemprop="dateModified" datetime="2024-05-24T22:27:40+08:00">2024-05-24</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i>赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img loading="lazy" data-src="/assets/wechatpay.png" alt="hqz 微信支付"/><p>微信支付</p></div><div><img loading="lazy" data-src="/assets/alipay.png" alt="hqz 支付宝"/><p>支付宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者：</strong>hqz<i class="ic i-at"><em>@</em></i>刀刀博客</li><li class="link"><strong>本文链接：</strong><a href="https://chnhqz.github.io/2024/05/23/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" title="计算机网络">https://chnhqz.github.io/2024/05/23/计算机网络/</a></li><li class="license"><strong>版权声明：</strong>本站所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2024/05/16/%E8%8B%B1%E8%AF%AD%E5%85%AD%E7%BA%A7%E4%BD%9C%E6%96%87/" rel="prev" itemprop="url" data-background-image="https:&#x2F;&#x2F;tva3.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gicitcxhpij20zk0m8hdt.jpg" title="英语六级作文"><span class="type">上一篇</span><h3>英语六级作文</h3></a></div><div class="item right"></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text"> 概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#osi%E7%9A%84%E4%B8%83%E5%B1%82%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B"><span class="toc-number">2.</span> <span class="toc-text"> OSI 的七层网络模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tcpudp"><span class="toc-number">3.</span> <span class="toc-text"> TCP&#x2F;UDP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#tcp%E6%8A%A5%E6%96%87%E7%BB%93%E6%9E%84"><span class="toc-number">3.1.</span> <span class="toc-text"> TCP 报文结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tcp%E4%BF%9D%E8%AF%81%E5%8F%AF%E9%9D%A0%E4%BC%A0%E8%BE%93"><span class="toc-number">3.2.</span> <span class="toc-text"> TCP 保证可靠传输</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%A1%E9%AA%8C%E5%92%8C"><span class="toc-number">3.2.1.</span> <span class="toc-text"> 校验和</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8F%B7%E7%A1%AE%E8%AE%A4%E5%BA%94%E7%AD%94"><span class="toc-number">3.2.2.</span> <span class="toc-text"> 序列号 &#x2F; 确认应答</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B6%85%E6%97%B6%E9%87%8D%E4%BC%A0"><span class="toc-number">3.2.3.</span> <span class="toc-text"> 超时重传</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E7%AE%A1%E7%90%86"><span class="toc-number">3.2.4.</span> <span class="toc-text"> 连接管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E6%8E%A7%E5%88%B6"><span class="toc-number">3.2.5.</span> <span class="toc-text"> 流量控制（滑动窗口控制）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E9%87%8D%E4%BC%A0"><span class="toc-number">3.2.6.</span> <span class="toc-text"> 快速重传</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6"><span class="toc-number">3.2.7.</span> <span class="toc-text"> 拥塞控制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%81%BF%E5%85%8D%E6%8B%A5%E5%A1%9E%E7%AE%97%E6%B3%95"><span class="toc-number">3.2.8.</span> <span class="toc-text"> 避免拥塞算法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8B%A5%E5%A1%9E%E5%8F%91%E7%94%9F"><span class="toc-number">3.2.8.1.</span> <span class="toc-text"> 拥塞发生</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E6%81%A2%E5%A4%8D"><span class="toc-number">3.2.8.2.</span> <span class="toc-text"> 快速恢复</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tcp%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B"><span class="toc-number">3.3.</span> <span class="toc-text"> TCP 三次握手</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><img class="image" loading="lazy" decoding="async" itemprop="image" alt="hqz" src="/assets/avatar.jpg"/><p class="name" itemprop="name">hqz</p><div class="description" itemprop="description">欢迎来到刀刀的笔记空间(^_^)</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">11</span><span class="name">文章</span></a></div></nav><div class="social"><a target="_blank" rel="noopener" href="https://github.com/name" class="item github" title="https:&#x2F;&#x2F;github.com&#x2F;name"><i class="ic i-github"></i></a></div><div class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li></div></div></div></div><ul id="quick"><li class="prev pjax"></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2024/05/16/%E8%8B%B1%E8%AF%AD%E5%85%AD%E7%BA%A7%E4%BD%9C%E6%96%87/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"></div><span><a href="/2023/05/22/papper/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/">未命名</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2023/06/07/test/hello-world/">Hello World</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2024/05/05/%E9%9F%B3%E8%A7%86%E9%A2%91/">音视频</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2023/06/08/papper/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB-1/">论文阅读</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2023/06/07/test/%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A2%E6%96%87%E7%AB%A0/">我的第一篇博客文章</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2024/05/05/mysql/">mysql</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2024/05/23/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2024/05/05/linux/linux-md/">linux.md</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2024/05/16/%E8%8B%B1%E8%AF%AD%E5%85%AD%E7%BA%A7%E4%BD%9C%E6%96%87/">英语六级作文</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2024/05/06/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/">论文阅读</a></span></li></ul></div><div class="rpost pjax"><h2>最新评论</h2></div></div><div class="status"><div class="copyright">&copy; 2022 -<span itemprop="copyrightYear">2024</span><span class="with-love"><i class="ic i-sakura rotate"></i></span><span class="author" itemprop="copyrightHolder">hqz @ testName</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i></span><span title="站点总字数">196k 字</span><span class="post-meta-divider"> | </span><span class="post-meta-item-icon"><i class="ic i-coffee"></i></span><span title="站点阅读时长">2:59</span></div><div class="powered-by">基于 <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> & Theme.<a target="_blank" rel="noopener" href="https://github.com/theme-shoka-x/hexo-theme-shokaX/">ShokaX</a></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL = {
    ispost: true,
        path: `2024/05/23/计算机网络/`,
        favicon: {
        show: `（●´3｀●）やれやれだぜ`,
        hide: `(´Д｀)大変だ！`
    },
    search: {
        placeholder: "文章搜索",
        empty: "关于 「 ${query} 」，什么也没搜到",
        stats: "${time} ms 内找到 ${hits} 条结果"
    },
    copy_tex: false,
    katex: false,
    mermaid: false,
    audio: undefined,
    fancybox: true,
    nocopy: false,
    outime: true,
    template: `<div class="note warning"><p><span class="label warning">文章时效性提示</span><br>这是一篇发布于 {{publish}} 天前，最后一次更新在 {{updated}} 天前的文章，部分信息可能已经发生改变，请注意甄别。</p></div>`,
    quiz: {
        choice: `单选题`,
        multiple: `多选题`,
        true_false: `判断题`,
        essay: `问答题`,
        gap_fill: `填空题`,
        mistake: `错题备注`
    },
    ignores: [
        (uri) => uri.includes('#'),
        (uri) => new RegExp(LOCAL.path + '$').test(uri),
            []
    ]
};
</script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/pace/1.2.4/pace.min.js" async></script><script src="/js/siteInit.js?v=0.4.2" type="module" fetchpriority="high" defer></script></body></html>